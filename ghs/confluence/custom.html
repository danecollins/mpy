/* this is installed in the Confluence Admin - Custom HTML (last entry) in the At the end of HEAD block */

<script type="text/javascript">
  var myWindow;
  function execmd(cmd) {
  	/* cmd can contain multiple commands. If so, parse them and execute them separately */

  	var cmds = cmd.split("|");

	console.log("EXECMD: " + cmds.length + " command received");

  	var baseURL = "http://localhost:8008/";

  	for (var i in cmds) {
        
        /* alert(cmds[i]); */
        console.log("  " + cmds[i]);
        
        /* handle various syntax shortcuts that are allowed in wiki macro */
        if (cmds[i].substring(0,13) == "OpenSchematic") {
    		  var parts = cmds[i].split(" ");
    		  cmds[i] = parts[0] + "?name=" + parts[1]
    		}
        if (cmds[i].substring(0,13) == "OpenSystemDiagram") {
          var parts = cmds[i].split(" ");
          cmds[i] = parts[0] + "?name=" + parts[1]
        }
    		if (cmds[i].substring(0,11) == "LoadProject") {
        		var parts = cmds[i].split(" ");
        		cmds[i] = parts[0] + "?name=" + parts[1]
    		}
        if (cmds[i].substring(0,11) == "LoadSchematic") {
            var parts = cmds[i].split(" ");
            cmds[i] = parts[0] + "?name=" + parts[1]
        }
        if (cmds[i].substring(0,11) == "LoadSystemDiagram") {
            var parts = cmds[i].split(" ");
            cmds[i] = parts[0] + "?name=" + parts[1]
        }
        if (cmds[i].substring(0,11) == "OpenUserFolder") {
            var parts = cmds[i].split(" ");
            cmds[i] = parts[0] + "?name=" + parts[1]
        }
        if (cmds[i].substring(0,11) == "OpenProject") {
            var parts = cmds[i].split(" ");
            cmds[i] = parts[0] + "?name=" + parts[1]
        }
    		if (cmds[i].substring(0,9) == "RunScript") {
        		var parts = cmds[i].split(" ");
        		cmds[i] = parts[0] + "?name=" + parts[1]
    }

		var path =  baseURL + cmds[i];
                console.log("    " + path);
        	/* myWindow = window.open(path, "LogWindow", "width=300, height=50"); */
		var request = new XMLHttpRequest();
		request.open('GET', path, false);
		try {
			/* send always throws an error but I don't know why */
			request.send(null);
		}
		catch (err) {
			console.log("      exeception: " + path);
		}
  	}
  }
</script>
